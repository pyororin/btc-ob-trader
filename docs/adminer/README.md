# `adminer` サービス 詳細設計書

## 1. サービスの概要

`adminer`サービスは、ウェブブラウザから`timescaledb`データベースを管理するための軽量なデータベース管理ツールです。公式の`adminer` Dockerイメージをそのまま利用しており、開発者がデータベースのテーブル構造を確認したり、保存されているデータを直接閲覧・操作したりすることを目的としています。

Grafanaがデータの「可視化（Read-only）」を担うのに対し、Adminerはより低レイヤーでの「データの確認・デバッグ・直接操作（Read/Write）」を担います。

## 2. Docker Compose上の役割と設定

`docker-compose.yml`における`adminer`サービスの定義は以下の通りです。

```yaml
services:
  adminer:
    image: adminer
    restart: always
    ports:
      - "8888:8080"
    networks:
      - bot_network
    depends_on:
      - timescaledb
```

### 設定解説

-   **`image: adminer`**: Docker Hubで公開されている公式のAdminerイメージを使用します。
-   **`restart: always`**: コンテナが停止した場合、理由を問わず常に再起動します。
-   **`ports: - "8888:8080"`**: Adminerコンテナがリッスンしている`8080`ポートを、ホストマシンの`8888`ポートにマッピングします。これにより、開発者は自身のPCのブラウザから `http://localhost:8888` にアクセスしてAdminerを利用できます。
-   **`networks: - bot_network`**: `bot`や`timescaledb`と同じ`bot_network`に所属させることで、Adminerコンテナから`timescaledb`コンテナへ名前解決でアクセスできるようにしています。
-   **`depends_on: - timescaledb`**: `timescaledb`サービスが起動してから`adminer`サービスが起動するように依存関係を定義しています。

## 3. 処理フローとロジック

`adminer`サービスには、本アプリケーション固有のロジックやコードは含まれていません。全ての処理は`adminer`イメージ内部で完結しています。

### 利用方法

1.  `docker compose up`で全サービスを起動します。
2.  ウェブブラウザで `http://localhost:8888` を開きます。
3.  Adminerのログイン画面が表示されます。以下の情報を入力してログインします。
    -   **システム (System)**: `PostgreSQL` を選択します。
    -   **サーバ (Server)**: `timescaledb` （`docker-compose.yml`で定義されたサービス名）を入力します。
    -   **ユーザ名 (Username)**: `.env`ファイルで定義した `DB_USER` の値を入力します。
    -   **パスワード (Password)**: `.env`ファイルで定義した `DB_PASSWORD` の値を入力します。
    -   **データベース (Database)**: `.env`ファイルで定義した `DB_NAME` の値を入力します。
4.  ログインに成功すると、データベース内のテーブル一覧が表示され、SQLコマンドの実行やデータの参照・編集が可能になります。

## 4. 設計思想と考慮点

-   **軽量性とシンプルさ**: Adminerは単一のPHPファイルで構成される非常に軽量なツールであり、phpMyAdminのような高機能なツールに比べて手軽に導入・利用できます。本プロジェクトでは、開発時のデバッグやデータ確認が主目的であるため、Adminerの機能で十分と判断されています。
-   **開発効率の向上**: 開発中に「`bot`サービスが正しく`trades`テーブルにデータを書き込めているか」「`report-generator`の集計結果は正しいか」といったことを確認したい場合に、GUIで迅速にデータを確認できるため、開発やデバッグの効率が大幅に向上します。
-   **セキュリティ**: この`adminer`サービスは、あくまで開発環境での利用を想定しています。もし本番環境にデプロイする場合は、AdminerへのアクセスをIPアドレスで制限したり、認証を強化したり、あるいはそもそも本番環境には含めないといったセキュリティ上の配慮が必要です。

## 5. 想定ユースケース

-   **スキーマの確認**: `db/schema`で定義したテーブルやビュー、インデックスが正しく作成されているかを確認する。
-   **データのリアルタイム確認**: `bot`を動かしながら、`order_book_updates`テーブルや`trades`テーブルにデータがリアルタイムで書き込まれていく様子を確認する。
-   **クエリのテスト**: Grafanaのダッシュボードで使うような複雑なSQLクエリを、先にAdminerのSQLコマンド実行画面で試行し、結果を確認する。
-   **データ不整合の調査**: テスト中に予期せぬ動作があった場合に、関連するテーブルのデータを直接参照し、原因を調査する。
-   **テストデータの投入・削除**: 手動でのテストシナリオを実行するために、特定のテストデータを挿入したり、テスト後のデータをクリーンアップしたりする。
